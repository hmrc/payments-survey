@*
* Copyright 2021 HM Revenue & Customs
*
* Licensed under the Apache License, Version 2.0 (the "License");
* you may not use this file except in compliance with the License.
* You may obtain a copy of the License at
*
* http://www.apache.org/licenses/LICENSE-2.0
*
* Unless required by applicable law or agreed to in writing, software
* distributed under the License is distributed on an "AS IS" BASIS,
* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
* See the License for the specific language governing permissions and
* limitations under the License.
*@
@import config.AppConfig
@import play.api.i18n.Messages
@import requests.JourneyRequest
@import views.TitleMaker.journeyTitleMaker
@import uk.gov.hmrc.govukfrontend.views.Aliases._
@import uk.gov.hmrc.govukfrontend.views.html.components.implicits.RichFormErrors
@import model.JourneyExt

@this(
        main: views.html.main,
        formWithCsrf: uk.gov.hmrc.govukfrontend.views.html.components.FormWithCSRF,
        errorSummary: uk.gov.hmrc.govukfrontend.views.html.components.govukErrorSummary,
        button: uk.gov.hmrc.govukfrontend.views.html.components.govukButton,
        radios: uk.gov.hmrc.govukfrontend.views.html.components.govukRadios,
        select: uk.gov.hmrc.govukfrontend.views.html.components.govukSelect,
        textArea: uk.gov.hmrc.govukfrontend.views.html.components.GovukTextarea,
        appConfig: AppConfig
)

@(form: Form[model.SurveyForm])(implicit request: JourneyRequest[_], m: Messages)

@radioInput(id: String, name: String, value: String) = {
    <input type="radio" id="@id" name="@name" value="@value" @form(name).value.filter(_ == value).map { _ => checked="checked" } >
}

@main(
    pageTitle = Some(journeyTitleMaker("survey.heading", Some(form))),
    navTitle = request.journey.contentOptions.title.forCurrentLanguage,
    backUrl = None
) {
    <h1 class="govuk-heading-xl">@Messages("survey.heading")</h1>
    <p class="govuk-body">@Messages("survey.instruction.text.1")</p>
    <p class="govuk-body">@Messages("survey.instruction.text.2.1")
        <a class="govuk-link" href="https://www.gov.uk/government/publications/data-protection-act-dpa-information-hm-revenue-and-customs-hold-about-you/data-protection-act-dpa-information-hm-revenue-and-customs-hold-about-you">
        @Messages("survey.privacy.notice.linktext")
        </a>
        @Messages("survey.instruction.text.2.2")
    </p>
    <p class="govuk-body">@Messages("survey.instruction.text.3")</p>
    @if(form.hasErrors) {
        @errorSummary(ErrorSummary(errorList = form.errors.asTextErrorLinks, title = Text("There's a problem")))
    }
    <div class="sign-out-survey">
    @formWithCsrf(action = controllers.routes.SurveyController.submitSurvey()) {
        <input type="hidden" name="journey" value = "@request.journey.status"/>
            <!-- 1. Were you able to do what you needed to do today? -->
        <div class="form-group payments">
            <p id="were-you-able-label" class="govuk-heading-m">1. @Messages("survey.wereYouAble.question")</p>
            @radios(Radios(
                fieldset = Some(Fieldset(legend = None)),
                errorMessage = form.error("wereYouAble").map(err => ErrorMessage(content = Text("selectBank_validation.show"))),
                name = "wereYouAble",
                items = Seq(
                    RadioItem(content = Text(Messages("survey.wereYouAble.response.yes"))),
                    RadioItem(content = Text(Messages("survey.wereYouAble.response.no")))
                )
            ))
        </div>
            <!-- 2. How easy was it for you to do what you needed to do today? -->
        <div class="form-group payments">
            <p id="how-easy-label" class="govuk-heading-m">2. @Messages("survey.howEasy.question")</p>
            @radios(Radios(
                fieldset = Some(Fieldset(legend = None)),
                errorMessage = form.error("howEasy").map(err => ErrorMessage(content = Text("howEasy"))),
                name = "howEasy",
                items = Seq(
                    RadioItem(content = Text(Messages("survey.howEasy.response.5"))),
                    RadioItem(content = Text(Messages("survey.howEasy.response.4"))),
                    RadioItem(content = Text(Messages("survey.howEasy.response.3"))),
                    RadioItem(content = Text(Messages("survey.howEasy.response.2"))),
                    RadioItem(content = Text(Messages("survey.howEasy.response.1")))
                )
            ))
        </div>
            <!-- 2b. Why did you give this score? -->
        <div class="form-group payments">
            <p id="why-score-label" class="govuk-heading-m">2b. @Messages("survey.comment.question")</p>
            @textArea(
                Textarea(
                    id = "why-score-field",
                    name = "comments",
                    rows = 4,
                    value = form("comments").value,
                    hint = Some(Hint(content = Text(Messages("survey.comment.limit")))),
                    attributes = Map("maxLength" -> "1200")
                )
            )
        </div>
            <!-- 3. Overall, how did you feel about the service you received today? -->
        <div class="form-group payments">
            <p id="overall-label" class="govuk-heading-m">3. @Messages("survey.overallRate.question")</p>
            @radios(Radios(
                fieldset = Some(Fieldset(legend = None)),
                errorMessage = form.error("overallRate").map(err => ErrorMessage(content = Text("selectBank_validation.show"))),
                name = "overallRate",
                items = Seq(
                    RadioItem(content = Text(Messages("survey.overallRate.response.5"))),
                    RadioItem(content = Text(Messages("survey.overallRate.response.4"))),
                    RadioItem(content = Text(Messages("survey.overallRate.response.3"))),
                    RadioItem(content = Text(Messages("survey.overallRate.response.2"))),
                    RadioItem(content = Text(Messages("survey.overallRate.response.1")))
                )
            ))
        </div>
        <br>
        <p id="thank-you-header" class="govuk-body">@Messages("survey.footnote.header")</p>
        <p id="thank-you-message" class="govuk-body">@Messages("survey.footnote.text")</p>

        @button(Button(
            content = Text(Messages("survey.submit")),
            attributes = Map("id" -> "continue-button")
        ))
        <p class="govuk-body">@views.html.no_survey_back_link()</p>
    }
    </div>
}
